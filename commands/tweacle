#!/usr/bin/env okshell

if (arguments.length < 1) {
  usage("usage: tweacle command [arguments]");
}

var command = arguments[0];

if (command == "list") {
	var user = arguments[1];
	var a = query("https://api.twitter.com/1.1/collections/list.json?screen_name=" + user);
	
	var collections = a.objects.timelines;

	for (var key in collections) {
		var coll = collections[key];
		print(key + "\t" + coll.name + "\t" + coll.collection_url);
	}
} else if (command == "entries") {
	var key = arguments[1];
	var a = query("https://api.twitter.com/1.1/collections/entries.json?id=" + key);
	
	var tweets = a.objects.tweets;
	
	for (var tweet_id in tweets) {
		var tweet = tweets[tweet_id];
		var user_id = tweet.user.id_str;
		var user = a.objects.users[user_id];
		
		print(tweet.id_str + "\t@" + user.screen_name + "\t" + tweet.text);

	    if (tweet.entities) {
	      if (tweet.entities.media) {
	        tweet.entities.media.map(function(media) {
	          show(media.media_url_https + ":thumb");
	        });
	      }
	    }
	}
}